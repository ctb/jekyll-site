
<!DOCTYPE html> 
<!--
	Noam's theme, based on Readnik scriptogr.am theme
-->
<html lang="en">
<head>
  <title>Noam Ross | Using Dates and Times in R</title>
  <meta name="description" content=" " />
  <meta name="author" content="Noam Ross">
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="ROBOTS" content="INDEX,FOLLOW">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta charset="utf-8">
  <meta property="og:url" content="">
  <meta property="og:site_name" content="Noam Ross">
  <link rel="icon" type="image/x-icon" href="/assets/themes/noamblog/atom.ico">
  <link href="/assets/themes/noamblog/css/style.css" rel="stylesheet" type="text/css" media="all">
  <link href="http://feeds.feedburner.com/noamross" rel="alternate" type="application/rss+xml" title="Noam Ross" />
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30394461-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
 </script>
 <script type="text/javascript"> 
    function typeset() {
      MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
    function disqus_config() {
      this.callbacks.onNewComment = [typeset];
      this.callbacks.onInit = [typeset];
    }
  </script>
  <script src="http://cachedcommons.org/javascripts/text/prettify-min.js" type="text/javascript"></script>
  <script src="http://cachedcommons.org/javascripts/text/showdown-min.js" type="text/javascript"></script>
  <script src="http://cachedcommons.org/javascripts/jquery/jquery.disqus.js" type="text/javascript"></script>
  <script type="text/javascript" src="/assets/themes/noamblog/app.js"></script>  
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
  <script type="text/x-mathjax-config">  MathJax.Hub.Config({ "HTML-CSS": { availableFonts: ["TeX"], webfont: [null] }} ); </script>
  <script type="text/x-mathjax-config">  MathJax.Hub.Config({ TeX: { extensions: ["autobold.js"] }} ); </script>
  <script type="text/javascript">var switchTo5x=true;</script>
  <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "4376beef-ffcc-441e-a877-904acf7f379b", theme:'8', onhover:false, doNotHash:true, doNotCopy:true, hashAddressBar:false}); </script>
  <script type="text/javascript">
      function chgifr(url, iframe)  {
          document.getElementById(iframe).src = url;
      }
  </script>
  <script type="text/javascript">
      function showhide(id) {
           var e = document.getElementById(id);
           if(e.style.display == 'block')
              e.style.display = 'none';
           else
              e.style.display = 'block';
        }
  </script>  
</head>
<body>
<div class="wrapper">
  <div class="blog">
 
      <div id="menu" class="menu-top">
        <div class="blog-info">
          <h1><a href="/index.html">Noam Ross</a></h1>
          <div class="blog-description">
           <h2>Real-time research in ecology, economics, and sustainability</h2>
          </div>
         </div>
          <div class="pages">
            
            <!-- Lockerz Share BEGIN -->
            <a class="a2a_dd" href="http://www.addtoany.com/share_save" tile"Share this Page"><span class="shareicon"><span class="hide">Share</span></span></a>
            <script type="text/javascript">
            var a2a_config = a2a_config || {};
            a2a_config.onclick = 0;
            a2a_config.show_title = 1;
            a2a_config.color_main = "FFFFFF";
            a2a_config.color_border = "FFFFFF";
            a2a_config.color_link_text = "45462f";
            a2a_config.color_link_text_hover = "575757";
            a2a_config.prioritize = ["twitter", "facebook", "tumblr", "email", "delicious", "linkedin", "stumbleupon", "google_plus"];
            </script>
            <script type="text/javascript" src="http://static.addtoany.com/menu/page.js"></script>
            <!-- Lockerz Share END -->
            
            <a href="http://feeds.feedburner.com/noamross" title="Subscribe via Feedburner RSS"> <span class="rssicon"> <span class="hide">RSS</span></span></a>
            
             
             
            


  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
    	
    	<a href="/about.html">About</a>
    	
    
  
    
  
    
  
    
  
    
    	
    	<a href="/connect.html">Connect</a>
    	
    
  
    
  
    
  
    
    	
    	<a href="/index.html">Blog</a>
    	
    
  
    
  
    
  
    
    	
    	<a href="/publications.html">Publications</a>
    	
    
  
    
  
    
  
    
  
    
  
    
    	
    	<a href="/tags.html">Topics</a>
    	
    
  
    
  



            
        </div>
      </div>

      <div class="container">

        <div class="content">
          
<div id="headblock">
<h1 id="page.title"><a href="/blog/2014/2/10/using-times-and-dates-in-r---presentation-code.html">Using Dates and Times in R</a></h1>
<p>by <em>Bonnie Dixon</em>, 10 February 2014</p>
<hr />
</div>
<div class="contenttext"><p><p><em>Today at the <a href="http://www.noamross.net/davis-r-users-group.html">Davis R Users’ Group</a>, <a href="http://ffhi.ucdavis.edu/people/directory/bmdixon">Bonnie Dixon</a> gave a tutorial on the various ways to handle dates and times in R. Bonnie provided this great script which walks through essential classes, functions, and packages. Here it is piped through <code>knitr::spin</code>. The original R script can be found as a gist <a href="https://gist.github.com/noamross/8928124">here</a>.</em></p>
<h2 id="datetime-classes">Date/time classes</h2>
<p>Three date/time classes are built-in in R, Date, POSIXct, and POSIXlt.</p>
<h3 id="date">Date</h3>
<p>This is the class to use if you have only dates, but no times, in your data.</p>
<p>create a date:</p>
<pre class="sourceCode r"><code class="sourceCode r">dt1 &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2012-07-22&quot;</span>)
dt1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2012-07-22&quot;</code></pre>
<p>non-standard formats must be specified:</p>
<pre class="sourceCode r"><code class="sourceCode r">dt2 &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;04/20/2011&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;%m/%d/%Y&quot;</span>)
dt2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2011-04-20&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dt3 &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;October 6, 2010&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;%B %d, %Y&quot;</span>)
dt3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2010-10-06&quot;</code></pre>
<p>see list of format symbols:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="st">`</span><span class="dt">?</span><span class="st">`</span>(strptime)</code></pre>
<p><strong>calculations with dates:</strong></p>
<p>find the difference between dates:</p>
<pre class="sourceCode r"><code class="sourceCode r">dt1 -<span class="st"> </span>dt2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 459 days</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">difftime</span>(dt1, dt2, <span class="dt">units =</span> <span class="st">&quot;weeks&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 65.57 weeks</code></pre>
<p>Add or subtract days:</p>
<pre class="sourceCode r"><code class="sourceCode r">dt2 +<span class="st"> </span><span class="dv">10</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2011-04-30&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dt2 -<span class="st"> </span><span class="dv">10</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2011-04-10&quot;</code></pre>
<p>create a vector of dates and find the intervals between them:</p>
<pre class="sourceCode r"><code class="sourceCode r">three.dates &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-07-22&quot;</span>, <span class="st">&quot;2011-04-20&quot;</span>, <span class="st">&quot;2012-10-06&quot;</span>))
three.dates</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2010-07-22&quot; &quot;2011-04-20&quot; &quot;2012-10-06&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">diff</span>(three.dates)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time differences in days
## [1] 272 535</code></pre>
<p>create a sequence of dates:</p>
<pre class="sourceCode r"><code class="sourceCode r">six.weeks &lt;-<span class="st"> </span><span class="kw">seq</span>(dt1, <span class="dt">length =</span> <span class="dv">6</span>, <span class="dt">by =</span> <span class="st">&quot;week&quot;</span>)
six.weeks</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2012-07-22&quot; &quot;2012-07-29&quot; &quot;2012-08-05&quot; &quot;2012-08-12&quot; &quot;2012-08-19&quot;
## [6] &quot;2012-08-26&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">six.weeks &lt;-<span class="st"> </span><span class="kw">seq</span>(dt1, <span class="dt">length =</span> <span class="dv">6</span>, <span class="dt">by =</span> <span class="dv">14</span>)
six.weeks</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2012-07-22&quot; &quot;2012-08-05&quot; &quot;2012-08-19&quot; &quot;2012-09-02&quot; &quot;2012-09-16&quot;
## [6] &quot;2012-09-30&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">six.weeks &lt;-<span class="st"> </span><span class="kw">seq</span>(dt1, <span class="dt">length =</span> <span class="dv">6</span>, <span class="dt">by =</span> <span class="st">&quot;2 weeks&quot;</span>)
six.weeks</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2012-07-22&quot; &quot;2012-08-05&quot; &quot;2012-08-19&quot; &quot;2012-09-02&quot; &quot;2012-09-16&quot;
## [6] &quot;2012-09-30&quot;</code></pre>
<p>see the internal integer representation</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unclass</span>(dt1)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 15543</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">dt1 -<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;1970-01-01&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 15543 days</code></pre>
<h3 id="posixct">POSIXct</h3>
<p>If you have times in your data, this is usually the best class to use.</p>
<p>create some POSIXct objects:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1 &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2013-07-24 23:55:26&quot;</span>)
tm1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:26 PDT&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm2 &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;25072013 08:32:07&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;%d%m%Y %H:%M:%S&quot;</span>)
tm2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-25 08:32:07 PDT&quot;</code></pre>
<p>specify the time zone:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm3 &lt;-<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2010-12-01 11:42:03&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;GMT&quot;</span>)
tm3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2010-12-01 11:42:03 GMT&quot;</code></pre>
<p><strong>some calculations with times</strong></p>
<p>compare times:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm2 &gt;<span class="st"> </span>tm1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] TRUE</code></pre>
<p>Add or subtract seconds:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1 +<span class="st"> </span><span class="dv">30</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:56 PDT&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm1 -<span class="st"> </span><span class="dv">30</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:54:56 PDT&quot;</code></pre>
<p>find the difference between times:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm2 -<span class="st"> </span>tm1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 8.611 hours</code></pre>
<p>automatically adjusts for daylight savings time:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.POSIXct</span>(<span class="st">&quot;2013-03-10 08:32:07&quot;</span>) -<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="st">&quot;2013-03-09 23:55:26&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 7.611 hours</code></pre>
<p>Get the current time (in POSIXct by default):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Sys.time</span>()</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2014-02-10 18:26:01 PST&quot;</code></pre>
<p>see the internal integer representation:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unclass</span>(tm1)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 1.375e+09
## attr(,&quot;tzone&quot;)
## [1] &quot;&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">difftime</span>(tm1, <span class="kw">as.POSIXct</span>(<span class="st">&quot;1970-01-01 00:00:00&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>), <span class="dt">units =</span> <span class="st">&quot;secs&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 1.375e+09 secs</code></pre>
<h3 id="posixlt">POSIXlt</h3>
<p>This class enables easy extraction of specific componants of a time. (“ct” stand for calender time and “lt” stands for local time. “lt” also helps one remember that POXIXlt objects are <em>lists</em>.)</p>
<p>create a time:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1.lt &lt;-<span class="st"> </span><span class="kw">as.POSIXlt</span>(<span class="st">&quot;2013-07-24 23:55:26&quot;</span>)
tm1.lt</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:26&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unclass</span>(tm1.lt)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## $sec
## [1] 26
## 
## $min
## [1] 55
## 
## $hour
## [1] 23
## 
## $mday
## [1] 24
## 
## $mon
## [1] 6
## 
## $year
## [1] 113
## 
## $wday
## [1] 3
## 
## $yday
## [1] 204
## 
## $isdst
## [1] 1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unlist</span>(tm1.lt)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##   sec   min  hour  mday   mon  year  wday  yday isdst 
##    26    55    23    24     6   113     3   204     1</code></pre>
<p>extract componants of a time object:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1.lt$sec</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 26</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm1.lt$wday</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 3</code></pre>
<p>truncate or round off the time:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trunc</span>(tm1.lt, <span class="st">&quot;days&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trunc</span>(tm1.lt, <span class="st">&quot;mins&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:00&quot;</code></pre>
<h3 id="chron">chron</h3>
<p>This class is a good option when you don’t need to deal with timezones. It requires the package <code>chron</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(chron)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Loading required package: chron
## 
## Attaching package: &#39;chron&#39;
## 
## The following objects are masked from &#39;package:lubridate&#39;:
## 
##     days, hours, minutes, seconds, years</code></pre>
<p>create some times:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1.c &lt;-<span class="st"> </span><span class="kw">as.chron</span>(<span class="st">&quot;2013-07-24 23:55:26&quot;</span>)
tm1.c</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] (07/24/13 23:55:26)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm2.c &lt;-<span class="st"> </span><span class="kw">as.chron</span>(<span class="st">&quot;07/25/13 08:32:07&quot;</span>, <span class="st">&quot;%m/%d/%y %H:%M:%S&quot;</span>)
tm2.c</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] (07/25/13 08:32:07)</code></pre>
<p>extract just the date:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dates</span>(tm1.c)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##     day  
## 07/24/13</code></pre>
<p>compare times:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm2.c &gt;<span class="st"> </span>tm1.c</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] TRUE</code></pre>
<p>add days:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1.c +<span class="st"> </span><span class="dv">10</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] (08/03/13 23:55:26)</code></pre>
<p>calculate the differene between times:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm2.c -<span class="st"> </span>tm1.c</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 08:36:41</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">difftime</span>(tm2.c, tm1.c, <span class="dt">units =</span> <span class="st">&quot;hours&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 8.611 hours</code></pre>
<p>does not adjust for daylight savings time:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.chron</span>(<span class="st">&quot;2013-03-10 08:32:07&quot;</span>) -<span class="st"> </span><span class="kw">as.chron</span>(<span class="st">&quot;2013-03-09 23:55:26&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 08:36:41</code></pre>
<p>Detach the <code>chron</code> package as it will interfere with <code>lubridate</code> later in this script.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(<span class="st">&quot;package:chron&quot;</span>, <span class="dt">unload =</span> <span class="ot">TRUE</span>)</code></pre>
<h3 id="summary-of-datetime-classes">Summary of date/time classes</h3>
<ul>
<li>When you just have dates, use Date.</li>
<li>When you have times, POSIXct is usually the best,</li>
<li>but POSIXlt enables easy extraction of specific components</li>
<li>and chron is simplest when you don’t need to deal with timezones and daylight savings time.</li>
</ul>
<h2 id="manipulating-times-and-dates">Manipulating times and dates</h2>
<h3 id="lubridate">lubridate</h3>
<p>This package is a wrapper for POSIXct with more intuitive syntax.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(lubridate)</code></pre>
<p>create a time:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1.lub &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2013-07-24 23:55:26&quot;</span>)
tm1.lub</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:26 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm2.lub &lt;-<span class="st"> </span><span class="kw">mdy_hm</span>(<span class="st">&quot;07/25/13 08:32&quot;</span>)
tm2.lub</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-25 08:32:00 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm3.lub &lt;-<span class="st"> </span><span class="kw">ydm_hm</span>(<span class="st">&quot;2013-25-07 4:00am&quot;</span>)
tm3.lub</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-25 04:00:00 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm4.lub &lt;-<span class="st"> </span><span class="kw">dmy</span>(<span class="st">&quot;26072013&quot;</span>)
tm4.lub</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-26 UTC&quot;</code></pre>
<p>some manipulations: extract or reassign componants:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">year</span>(tm1.lub)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 2013</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">week</span>(tm1.lub)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 30</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">wday</span>(tm1.lub, <span class="dt">label =</span> <span class="ot">TRUE</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] Wed
## Levels: Sun &lt; Mon &lt; Tues &lt; Wed &lt; Thurs &lt; Fri &lt; Sat</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hour</span>(tm1.lub)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 23</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tz</span>(tm1.lub)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">second</span>(tm2.lub) &lt;-<span class="st"> </span><span class="dv">7</span>
tm2.lub</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-25 08:32:07 UTC&quot;</code></pre>
<p>converting to decimal hours can facilitate some types of calculations:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1.dechr &lt;-<span class="st"> </span><span class="kw">hour</span>(tm1.lub) +<span class="st"> </span><span class="kw">minute</span>(tm1.lub)/<span class="dv">60</span> +<span class="st"> </span><span class="kw">second</span>(tm1.lub)/<span class="dv">3600</span>
tm1.dechr</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 23.92</code></pre>
<p>Lubridate distinguishes between four types of objects: instants, intervals, durations, and periods. An instant is a specific moment in time. Intervals, durations, and periods are all ways of recording time spans.</p>
<p>Dates and times parsed in lubridate are instants:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.instant</span>(tm1.lub)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] TRUE</code></pre>
<p>round an instant:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round_date</span>(tm1.lub, <span class="st">&quot;minute&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:00 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round_date</span>(tm1.lub, <span class="st">&quot;day&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-25 UTC&quot;</code></pre>
<p>get the current time or date as an instant:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">now</span>()</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2014-02-10 18:26:02 PST&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">today</span>()</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2014-02-10&quot;</code></pre>
<p>Note that lubridate uses UTC time zones as default.</p>
<p>see an instant in a different time zone:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with_tz</span>(tm1.lub, <span class="st">&quot;America/Los_Angeles&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 16:55:26 PDT&quot;</code></pre>
<p>change the time zone of an instant (keeping the same clock time):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">force_tz</span>(tm1.lub, <span class="st">&quot;America/Los_Angeles&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:26 PDT&quot;</code></pre>
<p>some calculations with instants. Note that the units are seconds:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm2.lub -<span class="st"> </span>tm1.lub</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Time difference of 8.611 hours</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm2.lub &gt;<span class="st"> </span>tm1.lub</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm1.lub +<span class="st"> </span><span class="dv">30</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:55:56 UTC&quot;</code></pre>
<p>An interval is the span of time that occurs between two specified instants.</p>
<pre class="sourceCode r"><code class="sourceCode r">in.bed &lt;-<span class="st"> </span><span class="kw">as.interval</span>(tm1.lub, tm2.lub)
in.bed</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 2013-07-24 23:55:26 UTC--2013-07-25 08:32:07 UTC</code></pre>
<p>Check whether a certain instant occured with a specified interval:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm3.lub %within%<span class="st"> </span>in.bed</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tm4.lub %within%<span class="st"> </span>in.bed</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] FALSE</code></pre>
<p>determine whether two intervals overlap:</p>
<pre class="sourceCode r"><code class="sourceCode r">daylight &lt;-<span class="st"> </span><span class="kw">as.interval</span>(<span class="kw">ymd_hm</span>(<span class="st">&quot;2013-07-25 06:03&quot;</span>), <span class="kw">ymd_hm</span>(<span class="st">&quot;2013-07-25 20:23&quot;</span>))
daylight</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 2013-07-25 06:03:00 UTC--2013-07-25 20:23:00 UTC</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">int_overlaps</span>(in.bed, daylight)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] TRUE</code></pre>
<p>A duration is a time span not anchored to specific start and end times. It has an exact, fixed length, and is stored internally in seconds.</p>
<p>create some durations:</p>
<pre class="sourceCode r"><code class="sourceCode r">ten.minutes &lt;-<span class="st"> </span><span class="kw">dminutes</span>(<span class="dv">10</span>)
ten.minutes</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;600s (~10 minutes)&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">five.days &lt;-<span class="st"> </span><span class="kw">ddays</span>(<span class="dv">5</span>)
five.days</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;432000s (~5 days)&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">one.year &lt;-<span class="st"> </span><span class="kw">dyears</span>(<span class="dv">1</span>)
one.year</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;31536000s (~365 days)&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.duration</span>(in.bed)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;31001s (~8.61 hours)&quot;</code></pre>
<p>arithmatic with durations:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm1.lub -<span class="st"> </span>ten.minutes</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-07-24 23:45:26 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">five.days +<span class="st"> </span><span class="kw">dhours</span>(<span class="dv">12</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;475200s (~5.5 days)&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ten.minutes/<span class="kw">as.duration</span>(in.bed)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 0.01935</code></pre>
<p>A period is a time span not anchored to specific start and end times, and measured in units larger than seconds with inexact lengths. create some periods:</p>
<pre class="sourceCode r"><code class="sourceCode r">three.weeks &lt;-<span class="st"> </span><span class="kw">weeks</span>(<span class="dv">3</span>)
three.weeks</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;21d 0H 0M 0S&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">four.hours &lt;-<span class="st"> </span><span class="kw">hours</span>(<span class="dv">4</span>)
four.hours</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;4H 0M 0S&quot;</code></pre>
<p>arithmatic with periods:</p>
<pre class="sourceCode r"><code class="sourceCode r">tm4.lub +<span class="st"> </span>three.weeks</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;2013-08-16 UTC&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">sabbatical &lt;-<span class="st"> </span><span class="kw">months</span>(<span class="dv">6</span>) +<span class="st"> </span><span class="kw">days</span>(<span class="dv">12</span>)
sabbatical</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] &quot;6m 12d 0H 0M 0S&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">three.weeks/sabbatical</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## estimate only: convert to intervals for accuracy

## [1] 0.108</code></pre>
<h3 id="calculating-mean-clock-times">Calculating mean clock times</h3>
<p>Say we have a vector of clock times in decimal hours, and we want to calculate the mean clock time.</p>
<pre class="sourceCode r"><code class="sourceCode r">bed.times &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">23.9</span>, <span class="fl">0.5</span>, <span class="fl">22.7</span>, <span class="fl">0.1</span>, <span class="fl">23.3</span>, <span class="fl">1.2</span>, <span class="fl">23.6</span>)
bed.times</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 23.9  0.5 22.7  0.1 23.3  1.2 23.6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(bed.times)  <span class="co"># doesn&#39;t work</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 13.61</code></pre>
<p>The clock has a circular scale, which ends where it begins, so we need to use circular statistics. (For more info on circular statistics see <a href="http://en.wikipedia.org/wiki/Mean_of_circular_quantities" class="uri">http://en.wikipedia.org/wiki/Mean_of_circular_quantities</a>.)</p>
<p>Get the package, psych.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(psych)
<span class="kw">circadian.mean</span>(bed.times)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 23.9</code></pre>
<h3 id="an-example-of-using-times-and-dates-in-a-data-frame">An example of using times and dates in a data frame</h3>
<p>Here is a data frame with a week of hypothetical times of going to bed and getting up for one person, and the total amount of time sleep time obtained each night according to a sleep monitoring device.</p>
<pre class="sourceCode r"><code class="sourceCode r">sleep &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">bed.time =</span> <span class="kw">ymd_hms</span>(<span class="st">&quot;2013-09-01 23:05:24&quot;</span>, <span class="st">&quot;2013-09-02 22:51:09&quot;</span>, 
    <span class="st">&quot;2013-09-04 00:09:16&quot;</span>, <span class="st">&quot;2013-09-04 23:43:31&quot;</span>, <span class="st">&quot;2013-09-06 00:17:41&quot;</span>, <span class="st">&quot;2013-09-06 22:42:27&quot;</span>, 
    <span class="st">&quot;2013-09-08 00:22:27&quot;</span>), <span class="dt">rise.time =</span> <span class="kw">ymd_hms</span>(<span class="st">&quot;2013-09-02 08:03:29&quot;</span>, <span class="st">&quot;2013-09-03 07:34:21&quot;</span>, 
    <span class="st">&quot;2013-09-04 07:45:06&quot;</span>, <span class="st">&quot;2013-09-05 07:07:17&quot;</span>, <span class="st">&quot;2013-09-06 08:17:13&quot;</span>, <span class="st">&quot;2013-09-07 06:52:11&quot;</span>, 
    <span class="st">&quot;2013-09-08 07:15:19&quot;</span>), <span class="dt">sleep.time =</span> <span class="kw">dhours</span>(<span class="kw">c</span>(<span class="fl">6.74</span>, <span class="fl">7.92</span>, <span class="fl">7.01</span>, <span class="fl">6.23</span>, <span class="fl">6.34</span>, 
    <span class="fl">7.42</span>, <span class="fl">6.45</span>)))
sleep</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##              bed.time           rise.time           sleep.time
## 1 2013-09-01 23:05:24 2013-09-02 08:03:29 24264s (~6.74 hours)
## 2 2013-09-02 22:51:09 2013-09-03 07:34:21 28512s (~7.92 hours)
## 3 2013-09-04 00:09:16 2013-09-04 07:45:06 25236s (~7.01 hours)
## 4 2013-09-04 23:43:31 2013-09-05 07:07:17 22428s (~6.23 hours)
## 5 2013-09-06 00:17:41 2013-09-06 08:17:13 22824s (~6.34 hours)
## 6 2013-09-06 22:42:27 2013-09-07 06:52:11 26712s (~7.42 hours)
## 7 2013-09-08 00:22:27 2013-09-08 07:15:19 23220s (~6.45 hours)</code></pre>
<p>We want to calculate sleep efficiency, the percent of time in bed spent asleep.</p>
<pre class="sourceCode r"><code class="sourceCode r">sleep$efficiency &lt;-<span class="st"> </span><span class="kw">round</span>(sleep$sleep.time/(sleep$rise.time -<span class="st"> </span>sleep$bed.time) *<span class="st"> </span>
<span class="st">    </span><span class="dv">100</span>, <span class="dv">1</span>)
sleep</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">##              bed.time           rise.time           sleep.time efficiency
## 1 2013-09-01 23:05:24 2013-09-02 08:03:29 24264s (~6.74 hours)       75.2
## 2 2013-09-02 22:51:09 2013-09-03 07:34:21 28512s (~7.92 hours)       90.8
## 3 2013-09-04 00:09:16 2013-09-04 07:45:06 25236s (~7.01 hours)       92.3
## 4 2013-09-04 23:43:31 2013-09-05 07:07:17 22428s (~6.23 hours)       84.2
## 5 2013-09-06 00:17:41 2013-09-06 08:17:13 22824s (~6.34 hours)       79.3
## 6 2013-09-06 22:42:27 2013-09-07 06:52:11 26712s (~7.42 hours)       90.9
## 7 2013-09-08 00:22:27 2013-09-08 07:15:19 23220s (~6.45 hours)       93.7</code></pre>
<p>Now let’s calculate the mean of each column:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colMeans</span>(sleep)  <span class="co"># doesn&#39;t work</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## Error: &#39;x&#39; must be numeric</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">circadian.mean</span>(<span class="kw">hour</span>(sleep$bed.time) +<span class="st"> </span><span class="kw">minute</span>(sleep$bed.time)/<span class="dv">60</span> +<span class="st"> </span><span class="kw">second</span>(sleep$bed.time)/<span class="dv">3600</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 23.6</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">circadian.mean</span>(<span class="kw">hour</span>(sleep$rise.time) +<span class="st"> </span><span class="kw">minute</span>(sleep$rise.time)/<span class="dv">60</span> +<span class="st"> </span><span class="kw">second</span>(sleep$rise.time)/<span class="dv">3600</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 7.559</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(sleep$sleep.time)/<span class="dv">3600</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 6.873</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(sleep$efficiency)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## [1] 86.63</code></pre>
<p>We can also plot sleep duration and efficiency across the week:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>))
<span class="kw">plot</span>(<span class="kw">round_date</span>(sleep$rise.time, <span class="st">&quot;day&quot;</span>), sleep$efficiency, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, 
    <span class="dt">xlab =</span> <span class="st">&quot;Morning&quot;</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>)
<span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(<span class="kw">round_date</span>(sleep$rise.time, <span class="st">&quot;day&quot;</span>), sleep$sleep.time/<span class="dv">3600</span>, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>, 
    <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">ylab =</span> <span class="ot">NA</span>, <span class="dt">xlab =</span> <span class="ot">NA</span>)
<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">4</span>)
<span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">4</span>, <span class="dt">line =</span> <span class="fl">2.5</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;Sleep duration&quot;</span>)
<span class="kw">mtext</span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="fl">2.5</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Sleep efficiency&quot;</span>)</code></pre>
<figure>
<img src="http://dl.dropbox.com/u/3356641/blogstuff/dixondates.png" alt="plot of chunk unnamed-chunk-50" /><figcaption>plot of chunk unnamed-chunk-50</figcaption>
</figure>
<h2 id="more-resources-on-times-and-dates">More resources on times and dates</h2>
<p>date and time tutorials for R:</p>
<ul>
<li><a href="http://www.stat.berkeley.edu/classes/s133/dates.html" class="uri">http://www.stat.berkeley.edu/classes/s133/dates.html</a></li>
<li><a href="http://science.nature.nps.gov/im/datamgmt/statistics/r/fundamentals/dates.cfm" class="uri">http://science.nature.nps.gov/im/datamgmt/statistics/r/fundamentals/dates.cfm</a></li>
<li><a href="http://en.wikibooks.org/wiki/R_Programming/Times_and_Dates" class="uri">http://en.wikibooks.org/wiki/R_Programming/Times_and_Dates</a></li>
</ul>
<p>lubridate:</p>
<ul>
<li><a href="http://www.jstatsoft.org/v40/i03/paper" class="uri">http://www.jstatsoft.org/v40/i03/paper</a></li>
</ul>
<p>time zone and daylight saving time info:</p>
<ul>
<li><a href="http://www.timeanddate.com/" class="uri">http://www.timeanddate.com/</a></li>
<li><a href="http://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="uri">http://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a></li>
<li><a href="http://www.twinsun.com/tz/tz-link.htm" class="uri">http://www.twinsun.com/tz/tz-link.htm</a></li>
<li>Also see the R help file at ?Sys.timezone</li>
</ul>
</p></div>
<ul class="tags">
  
    <li><strong>Tags: </strong></li>
    
    <li><a href="/tags.html#R-ref">R</a></li>
    
    <li><a href="/tags.html#D-RUG-ref">D-RUG</a></li>
      
</ul>



  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'noamrossgh'; // required: replace example with your forum shortname
    var disqus_identifier = '/blog/2014/2/10/using-times-and-dates-in-r---presentation-code.html';
    var disqus_url = 'http://www.noamross.net/blog/2014/2/10/using-times-and-dates-in-r---presentation-code.html';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>





<div class="noprint" id="previous-posts"><hr />
<p> <strong>Previous Post</strong>: <a href="/blog/2014/1/28/rpeekshiny.html">Ryan Peek on Creating Shiny Apps</a> </p>
<p> <strong>Next Post</strong>: <a href="/blog/2014/2/27/esaab.html">ESA 2014 Abstract: Modeling forest disease using a macroparasite framework</a> </p></div>



        </div>
    

      </div>
      
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script type="text/javascript" src="/assets/themes/noamblog/footnote-links.js"></script>
<script type="text/javascript">$('div.contenttext').footnoteLinks();</script>
</body>
</html>
